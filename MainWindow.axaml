<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Yellowcake.ViewModels"
        xmlns:conv="using:Yellowcake.Converters"
        xmlns:models="using:Yellowcake.Models"
        x:Class="Yellowcake.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="Yellowcake - Nuclear Option Mod Manager"
        Width="1100" Height="800"
        Background="{StaticResource DeepBackgroundBrush}"
        WindowStartupLocation="CenterScreen"
        ExtendClientAreaToDecorationsHint="True">

	<Window.Resources>
		<conv:GreaterThanZeroConverter x:Key="GreaterThanZeroConverter"/>

		<DataTemplate x:Key="ModItemTemplate" x:DataType="models:Mod">
			<Border Background="{StaticResource CardBackgroundBrush}" Margin="0,0,0,12" Padding="20" CornerRadius="16" BorderBrush="#1A1A1A" BorderThickness="1">
				<Grid ColumnDefinitions="*, Auto, Auto">
					<StackPanel Spacing="8">
						<StackPanel Orientation="Horizontal" Spacing="12">
							<TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="18" Foreground="White"/>
							<Border Background="#1C355E" CornerRadius="8" Padding="10,2" IsVisible="{Binding IsVoicePack}">
								<TextBlock Text="VOICE" FontSize="10" FontWeight="Bold" Foreground="#A8C7FF"/>
							</Border>
							<Border Background="#1E3E24" CornerRadius="8" Padding="10,2" IsVisible="{Binding IsLivery}">
								<TextBlock Text="LIVERY" FontSize="10" FontWeight="Bold" Foreground="#C4EED0"/>
							</Border>
						</StackPanel>
						<TextBlock Text="{Binding Author, StringFormat='by {0}'}" FontSize="13" Foreground="#888"/>
					</StackPanel>

					<StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Spacing="24">
						<Border IsVisible="{Binding HasUpdate}" Background="#3D2D00" Padding="12,6" CornerRadius="20">
							<TextBlock Text="Update Available" FontSize="11" FontWeight="Bold" Foreground="{StaticResource SystemAccentBrush}"/>
						</Border>
						<ToggleSwitch IsChecked="{Binding IsEnabled}"
                                      Command="{Binding $parent[Window].((vm:MainViewModel)DataContext).ToggleModCommand}"
                                      CommandParameter="{Binding}"
                                      Theme="{StaticResource FluentToggleSwitchTheme}" />
					</StackPanel>

					<Button Grid.Column="2" Content="Uninstall" Margin="30,0,0,0"
                            Foreground="{StaticResource WarningBrush}" Background="Transparent"
                            Command="{Binding $parent[Window].((vm:MainViewModel)DataContext).DeleteModCommand}"
                            CommandParameter="{Binding}"/>
				</Grid>
			</Border>
		</DataTemplate>
	</Window.Resources>

	<Window.Styles>
		<Style Selector="TabItem">
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="FontWeight" Value="Medium"/>
			<Setter Property="Padding" Value="20,12"/>
			<Setter Property="Foreground" Value="#777"/>
		</Style>
		<Style Selector="TabItem:selected">
			<Setter Property="Foreground" Value="{StaticResource SystemAccentBrush}"/>
		</Style>
		<Style Selector="Button.Filled">
			<Setter Property="Background" Value="{StaticResource SystemAccentBrush}"/>
			<Setter Property="Foreground" Value="Black"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="CornerRadius" Value="24"/>
			<Setter Property="Padding" Value="24,10"/>
		</Style>
		<Style Selector="Button.Tonal">
			<Setter Property="Background" Value="#1E1E1E"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="CornerRadius" Value="24"/>
			<Setter Property="Padding" Value="24,10"/>
		</Style>
	</Window.Styles>

	<Grid RowDefinitions="Auto, *, Auto">
		<Border Grid.Row="0" Background="#121212" Padding="25,45,25,15" BorderBrush="#1A1A1A" BorderThickness="0,0,0,1">
			<Grid ColumnDefinitions="*, Auto">
				<StackPanel Orientation="Horizontal" Spacing="20">
					<TextBlock Text="YELLOWCAKE" FontWeight="Black" FontSize="24" Foreground="{StaticResource SystemAccentBrush}" LetterSpacing="1.5"/>
					<Rectangle Width="1" Fill="#333" Height="24" VerticalAlignment="Center"/>
					<StackPanel VerticalAlignment="Center">
						<TextBlock Text="STATUS" FontSize="9" FontWeight="Black" Foreground="#666" LetterSpacing="1"/>
						<TextBlock Text="{Binding GameStatus}" FontSize="13" FontWeight="SemiBold" Foreground="White"/>
					</StackPanel>
				</StackPanel>

				<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="15" VerticalAlignment="Center">
					<StackPanel IsVisible="{Binding BepInExDownloadProgress, Converter={StaticResource GreaterThanZeroConverter}}" Spacing="6" VerticalAlignment="Center">
						<TextBlock Text="System Update In Progress" FontSize="10" Foreground="#999" HorizontalAlignment="Right"/>
						<ProgressBar Value="{Binding BepInExDownloadProgress}" Minimum="0" Maximum="100" Width="150" Height="4" Foreground="{StaticResource SystemAccentBrush}"/>
					</StackPanel>
					<Button Command="{Binding InstallBepInExCommand}" IsVisible="{Binding !IsBepInstalled}" Classes="Filled" Content="Setup BepInEx" />
				</StackPanel>
			</Grid>
		</Border>

		<TabControl Grid.Row="1" Margin="20,10">
			<TabControl.ItemsPanel>
				<ItemsPanelTemplate>
					<DockPanel LastChildFill="False" />
				</ItemsPanelTemplate>
			</TabControl.ItemsPanel>

			<TabItem Header="Mods" DockPanel.Dock="Left">
				<Panel>
					<StackPanel IsVisible="{Binding !ModList.Count}" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="16">
						<PathIcon Data="{StaticResource box_regular}" Width="48" Height="48" Foreground="#222"/>
						<TextBlock Text="Hangar is empty" FontSize="20" FontWeight="SemiBold" Foreground="#444"/>
					</StackPanel>
					<ListBox ItemsSource="{Binding ModList}" Background="Transparent" Margin="0,10" ItemTemplate="{StaticResource ModItemTemplate}"/>
				</Panel>
			</TabItem>

			<TabItem Header="Voice Packs" DockPanel.Dock="Left">
				<Panel>
					<StackPanel IsVisible="{Binding !HasVoicePacks}" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="16">
						<PathIcon Data="{StaticResource box_regular}" Width="48" Height="48" Foreground="#222"/>
						<TextBlock Text="No Voice Packs Found" FontSize="20" FontWeight="SemiBold" Foreground="#444"/>
					</StackPanel>
					<ListBox ItemsSource="{Binding VoicePacks}" Background="Transparent" Margin="0,10" ItemTemplate="{StaticResource ModItemTemplate}"/>
				</Panel>
			</TabItem>

			<TabItem Header="Liveries" DockPanel.Dock="Left">
				<Panel>
					<StackPanel IsVisible="{Binding !HasLiveries}" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="16">
						<PathIcon Data="{StaticResource box_regular}" Width="48" Height="48" Foreground="#222"/>
						<TextBlock Text="No Liveries Found" FontSize="20" FontWeight="SemiBold" Foreground="#444"/>
					</StackPanel>
					<ListBox ItemsSource="{Binding Liveries}" Background="Transparent" Margin="0,10" ItemTemplate="{StaticResource ModItemTemplate}"/>
				</Panel>
			</TabItem>

			<TabItem Header="Browse" DockPanel.Dock="Right">
				<Grid RowDefinitions="Auto, *">
					<TextBox Grid.Row="0" Text="{Binding SearchText}" Watermark="Search available mods..."
                             Margin="0,10,0,20" Height="50" VerticalContentAlignment="Center"
                             Background="#121212" BorderBrush="#222" CornerRadius="25" Padding="20,0">
						<TextBox.InnerLeftContent>
							<PathIcon Data="{StaticResource search_regular}" Width="16" Margin="15,0,0,0" Foreground="#555"/>
						</TextBox.InnerLeftContent>
					</TextBox>

					<ScrollViewer Grid.Row="1">
						<ItemsControl ItemsSource="{Binding AvailableMods}">
							<ItemsControl.ItemTemplate>
								<DataTemplate x:DataType="models:Mod">
									<Border Background="{StaticResource CardBackgroundBrush}" Margin="0,0,0,12" Padding="24" CornerRadius="16" BorderBrush="#1A1A1A" BorderThickness="1">
										<Grid ColumnDefinitions="*, 220">
											<StackPanel Spacing="10">
												<StackPanel Orientation="Horizontal" Spacing="12">
													<TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="20" Foreground="{StaticResource SystemAccentBrush}"/>
													<Border Background="#1E1E1E" CornerRadius="8" Padding="8,2">
														<TextBlock Text="{Binding Category}" FontSize="11" Foreground="#999"/>
													</Border>
												</StackPanel>
												<TextBlock Text="{Binding Description}" Foreground="#AAA" FontSize="14" TextWrapping="Wrap" MaxLines="2"/>
												<TextBlock Text="{Binding Author, StringFormat='Dev: {0}'}" Foreground="#555" FontSize="11" FontWeight="Medium"/>
											</StackPanel>

											<Grid Grid.Column="1" VerticalAlignment="Center" Margin="24,0,0,0">
												<Button Content="Install" Classes="Filled" IsVisible="{Binding !IsDownloading}"
                                                        Command="{Binding $parent[Window].((vm:MainViewModel)DataContext).DownloadModCommand}"
                                                        CommandParameter="{Binding}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center"/>

												<StackPanel IsVisible="{Binding IsDownloading}" Spacing="12">
													<ProgressBar Value="{Binding DownloadProgress}" Minimum="0" Maximum="100" Height="6" Foreground="{StaticResource SystemAccentBrush}"/>
													<Grid ColumnDefinitions="*, Auto">
														<TextBlock Text="{Binding DownloadProgress, StringFormat='{}{0:0}%'}" FontSize="12" FontWeight="Black" Foreground="{StaticResource SystemAccentBrush}"/>
														<Button Grid.Column="1" Content="Cancel" FontSize="11" Background="Transparent" Foreground="#666"
                                                                Command="{Binding $parent[Window].((vm:MainViewModel)DataContext).CancelDownloadCommand}"
                                                                CommandParameter="{Binding}"/>
													</Grid>
												</StackPanel>
											</Grid>
										</Grid>
									</Border>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</ScrollViewer>
				</Grid>
			</TabItem>
		</TabControl>

		<Border Grid.Row="2" Background="#0C0C0C" BorderBrush="#1A1A1A" BorderThickness="0,1,0,0" Padding="25,20">
			<Grid ColumnDefinitions="*, Auto">
				<Button Command="{Binding SelectExeCommand}" Background="Transparent" BorderThickness="0" VerticalAlignment="Center" Padding="0">
					<StackPanel Spacing="4">
						<TextBlock Text="EXECUTION PATH" FontSize="9" FontWeight="Black" Foreground="#444" LetterSpacing="1"/>
						<TextBlock Text="{Binding GamePath}" Foreground="#888" FontSize="12" TextTrimming="CharacterEllipsis" MaxWidth="500"/>
					</StackPanel>
				</Button>

				<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="16">
					<Button Content="Sync Manifest" Command="{Binding UpdateAllModsCommand}" Classes="Tonal"/>
					<Button Content="LAUNCH MISSION" Command="{Binding LaunchGameCommand}"
                            IsEnabled="{Binding IsGameDetected}"
                            Classes="Filled" Width="200" HorizontalContentAlignment="Center"/>
				</StackPanel>
			</Grid>
		</Border>
	</Grid>
</Window>