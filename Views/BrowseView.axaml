<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Yellowcake.ViewModels"
             xmlns:models="clr-namespace:Yellowcake.Models"
             xmlns:conv="using:Yellowcake.Converters"
             x:Class="Yellowcake.Views.BrowseView"
             x:DataType="vm:MainViewModel">

	<Grid RowDefinitions="Auto, Auto, *">
		<Grid Grid.Row="0" ColumnDefinitions="*, Auto" Margin="4,8,4,16">
									<TextBox Grid.Column="0"
								 Text="{Binding SearchText}"
								 Watermark="Search mods, authors, or tags..."
								 Height="44"
								 VerticalContentAlignment="Center"
								 Background="{DynamicResource CardBackgroundBrush}"
								 BorderBrush="{DynamicResource BorderBrush}"
								 BorderThickness="1"
								 CornerRadius="8"
								 FontSize="14">
				<TextBox.Transitions>
					<Transitions>
						<BrushTransition Property="BorderBrush" Duration="0:0:0.2"/>
						<BrushTransition Property="Background" Duration="0:0:0.2"/>
						<ThicknessTransition Property="BorderThickness" Duration="0:0:0.1"/>
					</Transitions>
				</TextBox.Transitions>

				<TextBox.Styles>
					<Style Selector="TextBox:focus /template/ Border#PART_BorderElement">
						<Setter Property="BorderBrush" Value="{DynamicResource SystemAccentBrush}"/>
						<Setter Property="Background" Value="#1A1A1A"/>
						<Setter Property="BorderThickness" Value="1.5"/>
					</Style>
					<Style Selector="TextBox:pointerover /template/ Border#PART_BorderElement">
						<Setter Property="BorderBrush" Value="{DynamicResource SystemAccentBrushLight}"/>
					</Style>
				</TextBox.Styles>

				<TextBox.InnerLeftContent>
					<PathIcon Data="{StaticResource SearchIcon}"
							  Width="16" Height="16"
							  Margin="14,0,8,0"
							  Foreground="{DynamicResource SystemAccentBrush}"
							  Opacity="0.6"/>
				</TextBox.InnerLeftContent>

				<TextBox.InnerRightContent>
					<Button Command="{Binding $parent[TextBox].Clear}"
							IsVisible="{Binding SearchText, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
							Classes="Icon"
							Margin="0,0,8,0"
							Padding="4"
							ToolTip.Tip="Clear Search">
						<PathIcon Data="{StaticResource CloseIcon}" Width="10" Height="10" Opacity="0.5"/>
					</Button>
				</TextBox.InnerRightContent>
			</TextBox>

			<Button Command="{Binding RefreshModsCommand}" Classes="Icon" ToolTip.Tip="Refresh Mod List" Grid.Column="1">
				<PathIcon Data="{StaticResource RefreshIcon}">
					<PathIcon.Styles>
						<Style Selector="PathIcon.loading">
							<Style.Animations>
								<Animation Duration="0:0:1" IterationCount="Infinite">
									<KeyFrame KeyTime="0:0:0">
										<Setter Property="RotateTransform.Angle" Value="0"/>
									</KeyFrame>
									<KeyFrame KeyTime="0:0:1">
										<Setter Property="RotateTransform.Angle" Value="360"/>
									</KeyFrame>
								</Animation>
							</Style.Animations>
						</Style>
					</PathIcon.Styles>
				</PathIcon>
			</Button>
		</Grid>

		<Grid Grid.Row="1" ColumnDefinitions="*, Auto" Margin="0,0,0,16">
			<ScrollViewer Grid.Row="1"
				  HorizontalScrollBarVisibility="Hidden"
				  VerticalScrollBarVisibility="Disabled"
				  Margin="0,0,0,16">
				<StackPanel Orientation="Horizontal" Spacing="8">
					<RadioButton Classes="FilterChip"
								 IsChecked="{Binding ActiveFilter, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static models:ModFilter.All}}"
								 Command="{Binding SetFilterCommand}"
								 CommandParameter="{x:Static models:ModFilter.All}">
						<Grid ColumnDefinitions="28,*">
							<PathIcon Data="{StaticResource CheckIcon}" Width="14" Height="14" HorizontalAlignment="Left"
									  IsVisible="{Binding $parent[RadioButton].IsChecked}" />
							<TextBlock Grid.Column="1" Text="All" VerticalAlignment="Center"/>
						</Grid>
					</RadioButton>

					<RadioButton Classes="FilterChip"
								 IsChecked="{Binding ActiveFilter, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static models:ModFilter.Plugins}}"
								 Command="{Binding SetFilterCommand}"
								 CommandParameter="{x:Static models:ModFilter.Plugins}">
						<Grid ColumnDefinitions="28,*">
							<PathIcon Data="{StaticResource CheckIcon}" Width="14" Height="14" HorizontalAlignment="Left"
									  IsVisible="{Binding $parent[RadioButton].IsChecked}" />
							<TextBlock Grid.Column="1" Text="Plugins" VerticalAlignment="Center"/>
						</Grid>
					</RadioButton>

					<RadioButton Classes="FilterChip"
								 IsChecked="{Binding ActiveFilter, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static models:ModFilter.Voice}}"
								 Command="{Binding SetFilterCommand}"
								 CommandParameter="{x:Static models:ModFilter.Voice}">
						<Grid ColumnDefinitions="28,*">
							<PathIcon Data="{StaticResource CheckIcon}" Width="14" Height="14" HorizontalAlignment="Left"
									  IsVisible="{Binding $parent[RadioButton].IsChecked}" />
							<TextBlock Grid.Column="1" Text="Voice Packs" VerticalAlignment="Center"/>
						</Grid>
					</RadioButton>

					<RadioButton Classes="FilterChip"
								 IsChecked="{Binding ActiveFilter, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static models:ModFilter.Livery}}"
								 Command="{Binding SetFilterCommand}"
								 CommandParameter="{x:Static models:ModFilter.Livery}">
						<Grid ColumnDefinitions="28,*">
							<PathIcon Data="{StaticResource CheckIcon}" Width="14" Height="14" HorizontalAlignment="Left"
									  IsVisible="{Binding $parent[RadioButton].IsChecked}" />
							<TextBlock Grid.Column="1" Text="Liveries" VerticalAlignment="Center"/>
						</Grid>
					</RadioButton>

					<RadioButton Classes="FilterChip"
								 IsChecked="{Binding ActiveFilter, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static models:ModFilter.Missions}}"
								 Command="{Binding SetFilterCommand}"
								 CommandParameter="{x:Static models:ModFilter.Missions}">
						<Grid ColumnDefinitions="28,*">
							<PathIcon Data="{StaticResource CheckIcon}" Width="14" Height="14" HorizontalAlignment="Left"
									  IsVisible="{Binding $parent[RadioButton].IsChecked}" />
							<TextBlock Grid.Column="1" Text="Missions" VerticalAlignment="Center"/>
						</Grid>
					</RadioButton>
				</StackPanel>
			</ScrollViewer>

			<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="16,0,0,0">
				<Separator Background="{DynamicResource BorderBrush}" Width="1" Height="20" VerticalAlignment="Center"/>

				<DropDownButton Classes="SortChip"
								Background="{DynamicResource CardBackgroundBrush}"
								BorderBrush="{DynamicResource BorderBrush}"
								BorderThickness="1"
								CornerRadius="8"
								Height="32">
					<StackPanel Orientation="Horizontal" Spacing="8">
						<PathIcon Data="{StaticResource SortIcon}" Width="12" Height="12" Foreground="{DynamicResource SystemAccentBrush}"/>
						<TextBlock Text="Sort" FontSize="12" VerticalAlignment="Center"/>
					</StackPanel>

					<DropDownButton.Flyout>
						<MenuFlyout Placement="BottomEdgeAlignedRight">
							<MenuItem Header="Name (A-Z)" Command="{Binding SetSortCommand}" CommandParameter="NameAsc"/>
							<MenuItem Header="Name (Z-A)" Command="{Binding SetSortCommand}" CommandParameter="NameDesc"/>
							<MenuItem Header="Latest Update" Command="{Binding SetSortCommand}" CommandParameter="Date"/>
							<MenuItem Header="Author" Command="{Binding SetSortCommand}" CommandParameter="Author"/>
						</MenuFlyout>
					</DropDownButton.Flyout>
				</DropDownButton>
			</StackPanel>
		</Grid>

		<ListBox Grid.Row="2"
         ItemsSource="{Binding AvailableMods}"
         Background="Transparent"
         BorderThickness="0"
         ScrollViewer.VerticalScrollBarVisibility="Auto">
			<ListBox.Styles>
				<Style Selector="ListBoxItem">
					<Setter Property="Padding" Value="12, 5"/>
					<Setter Property="Background" Value="Transparent"/>
					<Setter Property="HorizontalContentAlignment" Value="Stretch"/>
				</Style>
				<Style Selector="ListBoxItem:pointerover /template/ ContentPresenter, 
                       ListBoxItem:selected /template/ ContentPresenter">
					<Setter Property="Background" Value="Transparent"/>
				</Style>
			</ListBox.Styles>

			<ListBox.ItemTemplate>
				<DataTemplate x:DataType="models:Mod">
					<Border Background="{DynamicResource CardBackgroundBrush}"
							Padding="20"
							CornerRadius="12"
							BorderBrush="{DynamicResource BorderBrush}"
							BorderThickness="1"
							ClipToBounds="True">
						<Border.Transitions>
							<Transitions>
								<BrushTransition Property="BorderBrush" Duration="0:0:0.2"/>
								<TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15" Easing="CubicEaseOut"/>
							</Transitions>
						</Border.Transitions>

						<Border.Styles>
							<Style Selector="Border:pointerover">
								<Setter Property="BorderBrush" Value="{DynamicResource SystemAccentBrush}"/>
								<Setter Property="RenderTransform" Value="scale(1.005)"/>
							</Style>
						</Border.Styles>

						<Grid ColumnDefinitions="*, 24, 180">
							<StackPanel Grid.Column="0" Spacing="10">
								<StackPanel Orientation="Horizontal" Spacing="12">
									<TextBlock Text="{Binding Name}"
											 FontWeight="SemiBold"
											 FontSize="18"
											 Foreground="{DynamicResource MainTextBrush}"/>

									<Border Background="{DynamicResource SystemAccentBrushLight}"
											BorderBrush="{DynamicResource SystemAccentBrush}"
											BorderThickness="1"
											CornerRadius="6"
											Padding="8,2"
											VerticalAlignment="Center">
										<TextBlock Text="{Binding Category}"
												 FontSize="10"
												 FontWeight="Bold"
												 Foreground="{DynamicResource SystemAccentBrush}"/>
									</Border>

									<TextBlock Text="{Binding Version, StringFormat='v{0}'}"
											 Foreground="{DynamicResource SubTextBrush}"
											 FontSize="12"
											 VerticalAlignment="Center"
											 Opacity="0.6"/>
								</StackPanel>

								<TextBlock Text="{Binding Description}"
										 Foreground="{DynamicResource SubTextBrush}"
										 FontSize="14"
										 TextWrapping="Wrap"
										 MaxLines="2"
										 LineHeight="20"/>

								<StackPanel Orientation="Horizontal" Spacing="16">
									<StackPanel Orientation="Horizontal" Spacing="6">
										<PathIcon Data="{StaticResource UserIcon}" Width="12" Height="12"
												  Foreground="{DynamicResource SystemAccentBrush}" Opacity="0.8"/>
										<TextBlock Text="{Binding Author}" Foreground="{DynamicResource SubTextBrush}" FontSize="12"/>
									</StackPanel>



									<Border IsVisible="{Binding IsInstalled}"
											Background="#2200FF00"
											Padding="6,1"
											CornerRadius="4">
										<TextBlock Text="INSTALLED" FontSize="9" FontWeight="Bold" Foreground="#FF00FF00"/>
									</Border>
								</StackPanel>
							</StackPanel>

							<Panel Grid.Column="2" VerticalAlignment="Center">
								<Button Classes="Filled"
										Command="{Binding $parent[Window].((vm:MainViewModel)DataContext).DownloadModCommand}"
										CommandParameter="{Binding}"
										IsVisible="{Binding !IsInstalled}"
										IsEnabled="{Binding !IsDownloading}"
										HorizontalAlignment="Stretch" Height="40">
									<StackPanel Orientation="Horizontal" Spacing="8">
										<PathIcon Data="{StaticResource ArrowBottomIcon}" Width="14" Height="14"/>
										<TextBlock Text="INSTALL" FontWeight="Bold" FontSize="12"/>
									</StackPanel>
								</Button>

								<StackPanel IsVisible="{Binding IsDownloading}" Spacing="6">
									<Grid ColumnDefinitions="*, Auto">
										<TextBlock Text="Downloading..." FontSize="11" Foreground="{DynamicResource SubTextBrush}"/>
										<TextBlock Grid.Column="1" Text="{Binding DownloadProgress, StringFormat='{}{0}%'}"
												 FontSize="11" FontWeight="Bold" Foreground="{DynamicResource SystemAccentBrush}"/>
									</Grid>
									<ProgressBar Value="{Binding DownloadProgress}"
											   Minimum="0" Maximum="100"
											   Height="6"
											   Background="#33FFFFFF"
											   Foreground="{DynamicResource SystemAccentBrush}"
											   CornerRadius="3"/>
									<Button Classes="Link"
											Content="Cancel"
											FontSize="10"
											HorizontalAlignment="Center"
											Command="{Binding $parent[Window].((vm:MainViewModel)DataContext).CancelDownloadCommand}"
											CommandParameter="{Binding}"/>
								</StackPanel>

								<Button Classes="Tonal"
										Command="{Binding $parent[Window].((vm:MainViewModel)DataContext).DeleteModCommand}"
										CommandParameter="{Binding}"
										IsVisible="{Binding IsInstalled}"
										IsEnabled="{Binding !IsDownloading}"
										HorizontalAlignment="Stretch" Height="40">
									<StackPanel Orientation="Horizontal" Spacing="8">
										<PathIcon Data="{StaticResource DeleteIcon}" Width="14" Height="14"/>
										<TextBlock Text="UNINSTALL" FontWeight="Bold" FontSize="12"/>
									</StackPanel>
								</Button>
							</Panel>
						</Grid>
					</Border>
				</DataTemplate>
			</ListBox.ItemTemplate>
		</ListBox>
	</Grid>
</UserControl>